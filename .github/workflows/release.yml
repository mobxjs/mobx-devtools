name: Release

on: workflow_dispatch

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 17
          registry-url: https://registry.npmjs.org/
      - run: |
          VERSION=$(node -p "require('./lerna.json').version")
          gh auth setup-git
          git config --global user.name 'Release'
          git config --global user.email 'release@bot.com'
          # git checkout -b "bump-version-$VERSION"
          # git commit -am "chore: Bump version ($VERSION)"
          # git push --set-upstream origin "bump-version-$VERSION"
          # PR_URL="$(gh pr create --title "chore: Bump version ($VERSION)" --body 'This is automatic PR to bump version')"
          # gh workflow run "test.yml" --ref "bump-version-$VERSION"
          HEAD_BRANCH=bump-version-0.9.32
          HEAD_SHA=$(gh api repos/${GITHUB_REPOSITORY}/commits/$HEAD_BRANCH --jq '.sha')
          echo "Head SHA: $HEAD_SHA"

          # Create a successful check run for the commit
          gh api repos/${GITHUB_REPOSITORY}/check-runs \
            -F name="Automated Check" \
            -F head_sha="$HEAD_SHA" \
            -F status="completed" \
            -F conclusion="success" \
            -F output.title="All checks passed" \
            -F output.summary="This is a simulated successful check."

        env:
          GH_TOKEN: ${{ github.token }}
